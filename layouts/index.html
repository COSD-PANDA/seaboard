{{ define "main" }}
<div class="jumbotron jumbotron-fluid dp-jumbotron" id="dpJumbotron">
	<div class="jumbotron-content-layer">
		<div id="dpJumbotronContent" class="dp-jumbotron-content">
			<h1 class="intro-hed">San Diego Open Data</h1>
			<div class="intro-block-contain">
				<div class="intro-block pr-1">
					This is the official Open Data Portal for the City of San Diego.
				</div>  
				<div class="intro-block pr-1">
			     	{{ partial "search-fp" . }}
			    </div>
			    <div class="intro-block">
			     	or <a href="/datasets/">browse</a> for data about topics like <a href="/datasets/traffic-volumes/">traffic</a>, the <a href="/budget-topic/">City budget</a>, <a href="/departments/police/">police activity</a>, <a href="/datasets/business-listings/">local businesses</a>, and <a href="/datasets/">more</a>.
			    </div>
			</div>
			<div class="intro-menu">
				<a data-toggle="modal" data-target="#fpOverlay">
                    <svg id="modalOpenPlus" viewBox="0 0 30.41 30.41">
                        <line class="cls-1" y1="15.2" x2="30.41" y2="15.2"/>
                        <line class="cls-1" x1="15.2" y1="30.41" x2="15.2"/>
                    </svg>            
                </a>
			</div>
			<div class="intro-go">
				<a href="/datasets/">
                    <svg id="goArrow" viewBox="0 0 50 50">
                        <line y1="25" x2="48.5" y2="25"/>
                        <polyline points="33.29 9.8 48.5 25 33.29 40.2"/>
                    </svg>
                </a>
			</div>
		</div>
	</div>
	{{ partial "fp-overlay" . }}
	{{ partial "color-form" . }}
</div>

<script defer src="/assets/jquery.slim.min.js"></script>
<script defer src="/assets/bootstrap-4.4.1-dist/js/bootstrap.bundle.js"></script>
<script defer src="/assets/main.js"></script>
<script type="text/javascript">

let colorArray = []

{{ range $.Site.Data.colors.palette }}
 colorArray.push({{.}});
{{ end }}

(function() {
  'use strict';

  document.addEventListener('DOMContentLoaded', function(e) {
    
    console.log("Front page loaded");

    // Randomize colors

    let textColor = getRandomColor(colorArray);
    let textColorIndex = colorArray.indexOf(textColor)
    if (textColorIndex > -1) {
    	colorArray.splice(textColorIndex, 1)
    }
    let bgColor = getRandomColor(colorArray);
    setNewColors([textColor,bgColor]);

    document.getElementById("inputBackground").value = bgColor;
    document.getElementById("inputForeground").value = textColor;

    // Dropdown var for testing

    let ddHidden = true;

    $('#dropdownMenuParent').on('show.bs.dropdown', function () {
        ddHidden = false;
    }).on('hide.bs.dropdown', function () {
        ddHidden = true;
    });
    
    // Button event listener for search submit

    document.getElementById("searchSubmit").addEventListener("mousedown", (event) => {
    	
    	// When search button clicked, prevent default to avoid
    	// moving focus and deactivating search
    	// but submit the search

    	event.preventDefault();
    	searchSubmit();
    });

    // Keyboard event listener for search

    document.getElementById("searchQuery").addEventListener('keyup', (event) => {

    	// Check if key pressed is enter
        if (event.keyCode === 13) {
        	// If the dropdown is hidden, show it
            if (ddHidden) {
            	
                $('#searchSubmit').dropdown('toggle');
            }
            // Either way, run the search
            searchSubmit();
        } else {
        	// If key is any other, check to see if
        	// user has backspaced input clear
        	if (event.target.value === "") {
        		// If so, check if dropdown is showing
        		if (ddHidden === false) {
        			// If so, hide it
        			$('#searchSubmit').dropdown('toggle');
        		}
        	}
        }
    }, false);

    // Listener to activate search element

    document.getElementById("searchQuery").addEventListener("focus", searchClick)

    // Listener to deactivate search element

    document.getElementById("searchQuery").addEventListener("blur", (event) => {

    	//deActivateSearch(event.target,ddHidden);
    });

  })
})();
</script>
<script defer src="/assets/fuse.min.js"></script>
<script defer src="/assets/mark.min.js"></script>
<script defer src="/assets/search.js"></script>
{{ end }}