{{ define "main" }}
{{- $distroRowCounts := getCSV "," $.Site.Params.rowNosCsv }}
<div class="container">
	<div class="row">
		<div class="col pt-5">
			<div class="mb-4">
				{{ range .Params.departments }}
				<a class="btn btn-sm me-2 dataset-taxonomy-btn fst-italic fw-normal" href="/departments/{{ . | urlize }}" role="button">{{ . }}</a>
				{{ end }}
				{{ range .Params.categories }}
				<a class="btn btn-sm me-2 dataset-taxonomy-btn fst-italic fw-normal" href="/categories/{{ . | urlize }}" role="button">{{ . }}</a>
				{{ end }}
			</div>
			<h1 class="display-4 mb-5">
				{{ .Title }}
			</h1>
			<p class="mb-3"><span class="dataset-metadata-label fw-bold">Last updated:</span> </p>
			<div class="dataset-text fs-5 mb-5">
				{{ .Summary }}
			</div>
		</div>
	</div>
	<div class="row pb-7">
		<div class="col-4">
			{{- $pageCatList := $.Params.categories }}
			{{- $selectedPageCat := index $pageCatList 0 }}
			{{- range first 1 .Params.resources -}}
			{{ partial "download-card" (dict "resource" . "dlCardCat" (anchorize $selectedPageCat) "dlRows" $distroRowCounts) }}
			{{- end -}}
		</div>
		<div class="col-8">
			<div class="dataset-metadata mb-5">
				<p><span class="dataset-metadata-label fw-bold">Temporal:</span> {{ .Params.temporal }} {{ partial "temporal-definition" . }}</p>
				<p><span class="dataset-metadata-label fw-bold">Spatial:</span> {{ .Params.spatial }} {{ partial "spatial-definition" . }}</p>
				<p><span class="dataset-metadata-label fw-bold">Views:</span> </p>
				<p><span class="dataset-metadata-label fw-bold">Issued:</span> {{ .Params.date_issued }}</p>
			</div>
			<div class="dataset-jump-links mb-5">
				<span class="me-4 d-inline fst-italic">Jump to: </span>
				<a class="me-4" href="#dataDictionary">Data dictionary</a>
				<a class="me-4" href="#">Filter the data</a>
				<a class="me-4" href="#">Insights</a>
				{{ with .Content }}<a class="me-4" href="#addDetails">Additional details</a>{{ end }}
			</div>
			<div class="p-3 mb-2 dataset-tags d-flex align-items-center">
				<span class="me-4 d-inline">Tags: </span>
				{{ range .Params.tags }}
				<a class="tag me-4" href="/tags/{{ . | urlize }}">{{ . }}</a>
				{{ end }}
			</div>
		</div>
	</div>
</div>
{{- $noDistros := .Params.resources | len }}
{{- $remNoDistros := sub $noDistros 1 }}
{{- if gt $remNoDistros 0 }}
{{- $remDistros := last $remNoDistros  .Params.resources }}
{{- $filterGroups := slice }}
{{- range $remDistros }}
{{- range .filterGroup }}
{{- $filterGroups = $filterGroups | append . }}
{{- end }}
{{- end }}
{{- $uniqueFilterGroups := $filterGroups | uniq }}
<div class="container-fluid pb-7">
    <div class="container">
		<div class="row">
			<div class="col">
				<h1 class="display-6 mb-5">
					More Downloads
				</h1>
			</div>
		</div>
        <div class="row">
			<div class="col">
				<ul class="nav nav-pills more-downloads-nav fs-5 fw-bold mb-5" id="moreDownloadsTab" role="tablist">
					{{- range $i, $e := $uniqueFilterGroups }}
					<li class="nav-item me-5" role="presentation">
					<button class="nav-link {{ if eq 0 $i }}active{{ end }}" id="{{ $e }}-tab" data-bs-toggle="tab" data-bs-target="#{{ $e }}-tab-pane" type="button" role="tab" aria-controls="{{ $e }}-tab-pane" aria-selected={{ if eq 0 $i }}"true"{{ else }}"false"{{ end }}>Filtered by {{ $e }}</button>
					</li>
					{{- end }}
				</ul>
				<div class="tab-content" id="moreDownloadsTabContent">
					{{- range $i, $e := $uniqueFilterGroups }}
					<div class="tab-pane fade {{ if eq 0 $i }}show active{{ end }}" id="{{ $e }}-tab-pane" role="tabpanel" aria-labelledby="{{ $e }}-tab" tabindex="{{ $i }}">
						<div class="dictionary-table">
							<table class="table" id="accordionColumns">
								<tbody>
									{{- $remDistrosThisFilter := slice }}
									{{- range  sort $remDistros "weight" "desc" }}
									{{- $thisRemDistro := . }}
									{{- range .filterGroup }}
									{{- if eq . $e }}
									{{- $remDistrosThisFilter = $remDistrosThisFilter | append $thisRemDistro }}
									{{- end }}
									{{- end }}
									{{- end }}
									{{- range $i, $r := $remDistrosThisFilter }}
									{{- if eq $i ($remDistrosThisFilter | len) }}
									<tr id="final-data-field" class="fs-5 fw-semibold dictionary-accordion-header final-data-field-corners">
										<td class="align-middle">{{ .name }}</td>
										<td class="align-middle">
											<a href="{{ .url }}" class="btn btn-sm btn-{{ (anchorize $selectedPageCat) }}">Download</a>
										</td>
										<td><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ $i }}" aria-expanded="true" aria-controls="collapse{{ $i }}"></button></td>
									</tr>
									<tr id="collapse{{ $i }}" class="fs-6 dictionary-accordion-body final-data-def collapse" data-bs-parent="#accordionColumns">
										<td class="accordion-body" colspan="3">
											<p class="fs-5">Format: <span class="fw-bold">{{ .format }}</span></p>
											<p class="fs-5">File size: <span class="fw-bold">000 MB</span></p>
											<p class="fs-5">No. rows: <span class="fw-bold">0</span></p>
											<p class="fs-5">{{ .filter }}</p>
										</td>
									</tr>
									{{- else }}
									<tr class="fs-5 fw-semibold dictionary-accordion-header">
										<td class="align-middle">{{ .name }}</td>
										<td class="align-middle">
											<a href="{{ .url }}" class="btn btn-sm btn-outline-{{ (anchorize $selectedPageCat) }}">Download</a>
										</td>
										<td><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ $i }}" aria-expanded="true" aria-controls="collapse{{ $i }}"></button></td>
									</tr>
									<tr id="collapse{{ $i }}" class="fs-6 dictionary-accordion-body collapse" data-bs-parent="#accordionColumns">
										<td class="accordion-body" colspan="3">
											<p class="fs-5">Format: <span class="fw-bold">{{ .format }}</span></p>
											<p class="fs-5">File size: <span class="fw-bold">000 MB</span></p>
											<p class="fs-5">No. rows: <span class="fw-bold">0</span></p>
											<p class="fs-5">{{ .filter }}</p>
										</td>
									</tr>
									{{- end }}
									{{- end }}
								</tbody>
							</table>
						</div>
					</div>
					{{- end }}
				</div>
			</div>
        </div>
    </div>
</div>
{{- else }} 
{{- end }}
<div class="container-fluid dataset-dictionary-contain py-7">
	<div class="container">
		<div class="row">
			<div class="col">
				<div>
					<h1 class="display-4" id="dataDictionary">
						Data Dictionary
					</h1>
				</div>
			</div>
		</div>
		{{ partial "data-dictionary" . }} 
	</div>
</div>
{{ with .Content }}
<div class="container py-7">
	<div class="row">
		<div class="col">
			<div>
				<h1 class="display-4" id="addDetails">
					Additional details
				</h1>
			</div>
		</div>
	</div>
	<div class="row mt-4">
		{{ . }}
	</div>
</div>
{{ end }}
{{ partial "datasets-categories-lg" . }}
{{ end }}