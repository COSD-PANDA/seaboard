version: 2
jobs:
  build:
  working_directory:;; ~/seaboard
  docker:
    - image: circleci/node:6.14-jessie
  steps:
    - checkout
    - run:
      name: Install Yarn
      command: |
        curl -o- -L https://yarnpkg.com/install.sh | bash
        yarn cache clean
        bundle install
        yarn install --force
        bundle install

  deploy:
    docker:
      - image: circleci/node:6.14-jessie
    steps:
      - checkout
      - run:
          name: 'Deploy'
          command: |
            gulp build & gulp publish
            s3_website push

workflows:
  version: 2
  build_and_deploy:
    jobs:
      - build
    deploy:
      requires:
        - build
      filters:
        branches:
        only: master


